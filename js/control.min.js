$(document).ready(function(){function o(){body=new createjs.SpriteSheet({images:["body.png"],frames:{height:150,count:10,width:120}}),cloth=new createjs.SpriteSheet({images:["cloth.png"],frames:{height:150,count:10,width:120}}),face_shu=new createjs.SpriteSheet({images:["shuten_face.png"],frames:{height:150,count:7,width:120}}),face_ibara=new createjs.SpriteSheet({images:["ibaraki_face.png"],frames:{height:150,count:7,width:120}}),hair_shu=new createjs.SpriteSheet({images:["shuten_hair.png"],frames:{height:150,count:3,width:120}}),hair_ibara=new createjs.SpriteSheet({images:["ibaraki_hair.png"],frames:{height:150,count:3,width:120}}),dialog_shu=new createjs.SpriteSheet({images:["shuten_dialog.png"],frames:{height:150,count:10,width:120}}),dialog_ibara=new createjs.SpriteSheet({images:["ibaraki_dialog.png"],frames:{height:150,count:10,width:120}}),f.body=new createjs.Sprite(body),f.body.x=0,f.body.y=0,n.addChild(f.body),f.hair=new createjs.Sprite(hair_ibara),f.hair.x=0,f.hair.y=0,f.hair.gotoAndStop(0),n.addChild(f.hair),f.face=new createjs.Sprite(face_ibara),f.face.x=0,f.face.y=0,f.face.gotoAndStop(0),n.addChild(f.face),f.cloth=new createjs.Sprite(cloth),f.cloth.x=0,f.cloth.y=0,f.cloth.gotoAndStop(0),n.addChild(f.cloth),f.dialog=new createjs.Sprite(dialog_ibara),f.dialog.x=0,f.dialog.y=-50,f.dialog.timer=0,f.dialog.gotoAndStop(0),n.addChild(f.dialog),p.body=new createjs.Sprite(body),p.body.x=0,p.body.y=0,n.addChild(p.body),p.hair=new createjs.Sprite(hair_shu),p.hair.x=0,p.hair.y=0,p.hair.gotoAndStop(0),n.addChild(p.hair),p.face=new createjs.Sprite(face_shu),p.face.x=0,p.face.y=0,p.face.gotoAndStop(1),n.addChild(p.face),p.cloth=new createjs.Sprite(cloth),p.cloth.x=0,p.cloth.y=0,p.cloth.gotoAndStop(0),n.addChild(p.cloth),p.dialog=new createjs.Sprite(dialog_shu),p.dialog.x=0,p.dialog.y=-50,p.dialog.timer=0,p.dialog.gotoAndStop(0),n.addChild(p.dialog),p.body.play(),f.body.play(),createjs.Ticker.setFPS(l),createjs.Ticker.addEventListener("tick",i),$("#myCanvas").on("click",t),$("#shuten_skin,#ibaraki_skin").on("change",e),$("#shuten_cloth,#ibaraki_cloth").on("change",a),n.update()}function t(o){y=o.clientX,b=o.clientY}function e(){p.hair.gotoAndStop(parseInt($("#shuten_skin").val())),f.hair.gotoAndStop(parseInt($("#ibaraki_skin").val()))}function a(){p.cloth.gotoAndStop(parseInt($("#shuten_cloth").val())),f.cloth.gotoAndStop(parseInt($("#ibaraki_cloth").val()))}function d(o){g!==o&&(g=o,s=0)}function i(o){var t=y-p.body.x-u/2,e=b-p.body.y-S/2,a=y-f.body.x-u/2,i=b-f.body.y-S/2,c=Math.abs(p.body.x-f.body.x),h=Math.abs(p.body.y-f.body.y);if(t>0?p.body.scaleX<0&&(p.body.scaleX*=-1,p.body.x-=u,p.face.scaleX*=-1,p.face.x-=u,p.hair.scaleX*=-1,p.hair.x-=u,p.cloth.scaleX*=-1,p.cloth.x-=u,p.turnLeft=!1):p.body.scaleX>0&&(p.body.scaleX*=-1,p.body.x+=u,p.face.scaleX*=-1,p.face.x+=u,p.hair.scaleX*=-1,p.hair.x+=u,p.cloth.scaleX*=-1,p.cloth.x+=u,p.turnLeft=!0),p.body.x-f.body.x>0?f.body.scaleX<0&&(f.body.scaleX*=-1,f.body.x-=u,f.face.scaleX*=-1,f.face.x-=u,f.hair.scaleX*=-1,f.hair.x-=u,f.cloth.scaleX*=-1,f.cloth.x-=u,f.turnLeft=!1):f.body.scaleX>0&&(f.body.scaleX*=-1,f.body.x+=u,f.face.scaleX*=-1,f.face.x+=u,f.hair.scaleX*=-1,f.hair.x+=u,f.cloth.scaleX*=-1,f.cloth.x+=u,f.turnLeft=!0),c<150+(p.turnLeft==f.turnLeft?0:120)&&h<150+(p.turnLef==f.turnLeft?0:120))d("1"),p.face.gotoAndStop(5),s%5==0&&(s%2==0?f.face.gotoAndStop(1):f.face.gotoAndStop(2)),p.dialog.gotoAndStop(5),f.dialog.gotoAndStop(5),s>8*l?s=0:s>5*l&&(p.face.gotoAndStop(3),f.face.gotoAndStop(2),p.dialog.gotoAndStop(4),f.dialog.gotoAndStop(0));else if(300>c&&300>h){switch(d("2"),p.face.gotoAndStop(2),f.face.gotoAndStop(0),p.dialog.timer){case l/3:p.dialog.gotoAndStop(0);break;case l/2:p.dialog.gotoAndStop(1);break;case l:p.dialog.gotoAndStop(2),p.dialog.timer=0}switch(f.dialog.timer){case l/3:f.dialog.gotoAndStop(6);break;case l/2:f.dialog.gotoAndStop(7);break;case l:f.dialog.gotoAndStop(8),f.dialog.timer=0}}else 500>c&&500>h?(d("3"),p.face.gotoAndStop(0),f.face.gotoAndStop(3),p.dialog.gotoAndStop(3),f.dialog.gotoAndStop(2)):(d("4"),p.face.gotoAndStop(1),s%5==0&&(s%2==0?f.face.gotoAndStop(4):f.face.gotoAndStop(5)),p.dialog.gotoAndStop(8),f.dialog.gotoAndStop(1));Math.abs(t)>1&&Math.abs(e)>1?(p.body.x+=t*p.speed,p.body.y+=e*p.speed,p.face.x=p.body.x,p.face.y=p.body.y,p.hair.x=p.body.x,p.hair.y=p.body.y,p.cloth.x=p.body.x,p.cloth.y=p.body.y,p.dialog.x=p.body.x-(p.turnLeft?120:0),p.dialog.y=p.body.y-70,p.body.play()):p.body.gotoAndStop(0),500>c&&500>h&&(c>=100+(p.turnLeft==f.turnLeft?0:120)||h>=100+(p.turnLeft==f.turnLeft?0:120))?(f.body.x+=a*f.speed,f.body.y+=i*f.speed,f.face.x=f.body.x,f.face.y=f.body.y,f.hair.x=f.body.x,f.hair.y=f.body.y,f.cloth.x=f.body.x,f.cloth.y=f.body.y,f.dialog.x=f.body.x-(f.turnLeft?120:0),f.dialog.y=f.body.y-70,f.body.play()):f.body.gotoAndStop(0),p.dialog.timer>l?p.dialog.timer=0:p.dialog.timer++,f.dialog.timer>l?f.dialog.timer=0:f.dialog.timer++,s++,n.update()}var c,n;c=document.getElementById("myCanvas"),c.height=$(document).height(),c.width=$(document).width(),n=new createjs.Stage(c);var h,r;(new Date).getTime();h=$(document).height(),r=$(document).width();var l=30,g="",s=0,y=0,b=0,p={face:"",body:"",hair:"",cloth:"",dialog:"",speed:.05,turnLeft:!1},f={face:"",body:"",hair:"",cloth:"",dialog:"",speed:.01,turnLeft:!1},S=150,u=120;o()});